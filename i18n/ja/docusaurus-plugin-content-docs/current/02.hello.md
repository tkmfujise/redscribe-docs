---
sidebar_label: ã“ã‚“ã«ã¡ã¯ Ruby!
---
import Zoom from 'react-medium-image-zoom';

# ã“ã‚“ã«ã¡ã¯ Ruby!

## ã‚·ãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹

ã¾ãšã€ã‚·ãƒ¼ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚ã©ã‚“ãªãƒãƒ¼ãƒ‰ã§ã‚ã£ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€ä»Šå›ã¯ **Control** ãƒãƒ¼ãƒ‰ã‹ã‚‰ã‚·ãƒ¼ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

<Zoom>
![ã‚·ãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹](/img/tutorial/02.create-a-new-scene.png)
</Zoom>

æ¬¡ã«ã€GDScript ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚

<Zoom>
![GDScript ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹](/img/tutorial/02.attach-a-gdscript.png)
</Zoom>


## method_missing ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚‹

GDScript ã«ä»¥ä¸‹ã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚

```gdscript
extends Control

@onready var res := ReDScribe.new()


func _ready() -> void:
	res.method_missing.connect(_method_missing)
	res.perform("""
		Alice says: 'Hello Ruby! â¤'
	""")


func _method_missing(method_name: String, args: Array) -> void:
	print_debug('[method_missing] ', method_name, ': ', args)

```

ãã®å¾Œã€ã‚·ãƒ¼ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
<Zoom>
![method_missing ã§ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚‹](/img/tutorial/02.method_missing.png)
</Zoom>

å®Ÿè¡Œã™ã‚‹ã¨ã€**å‡ºåŠ›ãƒ‘ãƒãƒ«** ã«ä»¥ä¸‹ãŒå‡ºåŠ›ã•ã‚ŒãŸã¨æ€ã„ã¾ã™ã€‚
```
[method_missing] Alice: [{ &"says": "Hello Ruby! â¤" }]
   At: res://control.gd:14:_method_missing()
```
<Zoom>
![method_missing ã§ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚‹](/img/tutorial/02.method_missing_output.png)
</Zoom>


### ä½•ãŒèµ·ã“ã£ãŸã®ï¼Ÿ

ä¸€ã¤ãšã¤èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

#### 1. extends Control

```gdscript
extends Control
```
ã“ã®ã‚·ãƒ¼ãƒ³ãŒ **Control** ãƒãƒ¼ãƒ‰ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚
ã“ã®è¨˜è¿°ã¯ ReDScribe ã®å‡¦ç†ã¨ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚


#### 2. @onready var res := ReDScribe.new()

```gdscript
@onready var res := ReDScribe.new()
```
ReDScribe ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ã€`res` å¤‰æ•°ã«ä»£å…¥ã—ã¦ã„ã¾ã™ã€‚Godot ã§ã¯ã€ãƒãƒ¼ãƒ‰å†…ã§ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒ³ãƒå¤‰æ•°ã¯ã“ã®ã‚ˆã†ã«å…ˆé ­ã§å®šç¾©ã—ã¾ã™ã€‚

`@onready` ä¿®é£¾å­ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ã€ã‚·ãƒ¼ãƒ³ãŒ **ready** çŠ¶æ…‹ã«ãªã£ãŸã¨ãã€ã¤ã¾ã‚Šãƒãƒ¼ãƒ‰ã¨ãã®å­ãƒãƒ¼ãƒ‰ãŒã‚·ãƒ¼ãƒ³ãƒ„ãƒªãƒ¼ã«å…¥ã£ãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ¡ãƒ³ãƒå¤‰æ•°ã®åˆæœŸåŒ–ã«ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚


#### 3. func _ready() -> void:

```gdscript
func _ready() -> void:
	res.method_missing.connect(_method_missing)
	res.perform("""
		Alice says: 'Hello Ruby! â¤'
	""")
```

ReDScribe ã® **method_missing** ã‚·ã‚°ãƒŠãƒ«ã‚’ `_method_missing` é–¢æ•°ã§å—ã‘å–ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚

`res.perform` ã§ Ruby ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚


#### 4. func _method_missing(method_name: String, args: Array) -> void:

ä»¥ä¸‹ã‚’ Ruby ã§å®Ÿè¡Œã™ã‚‹ã¨ã€`Alice` ãƒ¡ã‚½ãƒƒãƒ‰ã«å¼•æ•° `says: 'Hello Ruby! â¤'` ãŒæ¸¡ã•ã‚ŒãŸã¨ Ruby ã¯è§£é‡ˆã—ã¾ã™ã€‚
```ruby
Alice says: 'Hello Ruby! â¤'
```

Ruby ã«ã¯ã€`Alice` ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã¯å®šç¾©ã•ã‚Œã¦ã„ãªã„ã®ã§ã€**method_missing** ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ãŒã€ReDScribe ã§ã¯ **metod_missing** ãŒç™ºç”Ÿã™ã‚‹ã¨ã‚·ã‚°ãƒŠãƒ«ã‚’ç™ºè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

`_method_missing` é–¢æ•°ã§ **metod_missing** ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ã—ãŸã®ã§ã€
```gdscript
func _method_missing(method_name: String, args: Array) -> void:
	print_debug('[method_missing] ', method_name, ': ', args)
```
ä»¥ä¸‹ã®ã‚ˆã†ã« **å‡ºåŠ›ãƒ‘ãƒãƒ«** ã«å‡ºåŠ›ã•ã‚ŒãŸã¨ã„ã†ã‚ã‘ã§ã™ã€‚
```
[method_missing] Alice: [{ &"says": "Hello Ruby! â¤" }]
```


## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ReDScribe ã§ã¯ã€å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã”ã¨ã« **mrb_state** ã¨ã„ã† mruby ã®å®Ÿè¡Œå˜ä½ã‚’ä½œæˆã—ã¾ã™ã€‚
ãã®ãŸã‚ã€åå‰ç©ºé–“ã¯å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã”ã¨ã«é–‰ã˜ã¦ã„ã¾ã™ã€‚
DSL ã‚’æ›¸ããŸã„å˜ä½ã§ ReDScribe ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

<Zoom>
![ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](/img/architecture.png)
</Zoom>

**Object#method_missing** ã§ã¯ **method_missing** ã‚·ã‚°ãƒŠãƒ«ã‚’ç™ºè¡Œã—ã¾ã™ãŒã€ãã‚Œä»¥å¤–ã«ã‚‚ **Godot.emit_signal** ã‚’ä½¿ã£ã¦ **channel** ã‚·ã‚°ãƒŠãƒ«ã‚’ç™ºè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚


## channel ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚‹

è©¦ã—ã«ã€GDScript ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›¿ãˆã¦ã¿ã¾ã™ã€‚
```gdscript
extends Control

@onready var res := ReDScribe.new()


func _ready() -> void:
	res.method_missing.connect(_method_missing)
	res.channel.connect(_subscribe) # Added
	res.perform("""
		Alice says: 'Hello Ruby! â¤'

		# Added
		puts "Welcome to the world of Ruby v#{RUBY_VERSION}, powered by #{RUBY_ENGINE} ğŸ’"

		# Added
		Godot.emit_signal :spawn, { name: 'Alice', job: :wizard, level: 1 }
	""")


func _method_missing(method_name: String, args: Array) -> void:
	print_debug('[method_missing] ', method_name, ': ', args)


# Added
func _subscribe(key: StringName, payload: Variant) -> void:
	print_debug('[subscribe] ', key, ': ', payload)

```

ä»¥ä¸‹ã®ã‚ˆã†ã« **å‡ºåŠ›ãƒ‘ãƒãƒ«** ã«è¡¨ç¤ºã•ã‚ŒãŸã¨æ€ã„ã¾ã™ã€‚

```
[method_missing] Alice: [{ &"says": "Hello Ruby! â¤" }]
   At: res://control.gd:19:_method_missing()
Welcome to the world of Ruby v3.4, powered by mruby ğŸ’
[subscribe] spawn: { &"name": "Alice", &"job": &"wizard", &"level": 1 }
   At: res://control.gd:23:_subscribe()
```

`Godot.emit_signal` ã‚’å®Ÿè¡Œã—ãŸã“ã¨ã§ã€**channel** ã‚·ã‚°ãƒŠãƒ«ãŒç™ºè¡Œã•ã‚Œã¾ã—ãŸã€‚
```ruby
Godot.emit_signal :spawn, { name: 'Alice', job: :wizard, level: 1 }
```
ç™ºè¡Œã•ã‚ŒãŸã‚·ã‚°ãƒŠãƒ«ã¯ `_subscribe(key: StringName, payload: Variant)` é–¢æ•°ã§å—ã‘å–ã‚Šã¾ã—ãŸã€‚
* ç¬¬1å¼•æ•° `:spawn` ãŒ `key`
* ç¬¬2å¼•æ•° `{ name: 'Alice', job: :wizard, level: 1 }` ãŒ `payload`


Ruby ã§ã€`:spawn` ã¯ Symbol ã‚¯ãƒ©ã‚¹ã§ã™ãŒã€GDScript ã§å—ã‘å–ã‚‹éš›ã¯ StringName å‹ã«ãªã‚Šã¾ã™ã€‚

GDScript ã® Variant å‹ã¯ä»»æ„ã®å‹ã‚’è¡¨ã™å‹ã§ã™ã€‚ã©ã‚“ãªãƒ‡ãƒ¼ã‚¿ãŒæ¸¡ã£ã¦ãã¦ã‚‚å‡¦ç†ã™ã‚‹å ´åˆã¯ã“ã®å‹ã‚’ä½¿ã„ã¾ã™ã€‚


## å‹å¤‰æ›

`perform` ã§ Ruby (mruby) ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€
**method_missing** ã‚·ã‚°ãƒŠãƒ«ã€**channel** ã‚·ã‚°ãƒŠãƒ«ã§æ¸¡ã£ã¦ãã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« GDScript ã®å‹ã«å¤‰æ›ã•ã‚Œã¦ãã¾ã™ã€‚

| mruby      |   | GDScript                      |
|------------|---|-------------------------------|
| true       | â‡’ | true                          |
| false      | â‡’ | false                         |
| nil        | â‡’ | null                          |
| Float      | â‡’ | float                         |
| Integer    | â‡’ | int                           |
| Symbol     | â‡’ | StringName                    |
| String     | â‡’ | String                        |
| Hash       | â‡’ | Dictionary                    |
| Array      | â‡’ | Array                         |
| Range      | â‡’ | Array                         |
| Time       | â‡’ | Dictionary                    |
| (ãã®ä»–)   | â‡’ | String<br />(#inspect ãƒ¡ã‚½ãƒƒãƒ‰ã§æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¾ã™) |


## ã©ã¡ã‚‰ã®ã‚·ã‚°ãƒŠãƒ«ã‚’ä½¿ã†ã¹ãã‹ï¼Ÿ

```ruby
Alice says: 'Hello Ruby! â¤'
```
ã‚’ **method_missing** ã§ã¯ãªã **channel** ã‚·ã‚°ãƒŠãƒ«ã§å—ã‘å–ã‚ŠãŸã„å ´åˆã¯ã€ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã¾ã™ã€‚

```gdscript
extends Control

@onready var res := ReDScribe.new()


func _ready() -> void:
	res.channel.connect(_subscribe)
	res.perform("""
		def Alice(**args)
		  Godot.emit_signal :action, { name: 'Alice', **args }
		end

		Alice says: 'Hello Ruby! â¤'
	""")


func _subscribe(key: StringName, payload: Variant) -> void:
	print_debug('[subscribe] ', key, ': ', payload)

```
```
[subscribe] action: { &"name": "Alice", &"says": "Hello Ruby! â¤" }
   At: res://control.gd:18:_subscribe()
```

`Alice` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ã€`Godot.emit_signal` ã‚’å†…éƒ¨ã§å‘¼ã¶ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
```ruby
def Alice(**args)
  Godot.emit_signal :action, { name: 'Alice', **args }
end
```

**channel** ã‚·ã‚°ãƒŠãƒ«ã‚’ä½¿ã†å ´åˆã¯ã€å¤šå°‘ã® Ruby ã®çŸ¥è­˜ãŒå¿…è¦ã«ãªã£ã¦ãã¾ã™ã€‚

æ°—è»½ã«ä½¿ã„ãŸã„å ´åˆã¯ **method_missing** ã‚·ã‚°ãƒŠãƒ«ã€ã‚‚ã£ã¨å‡ã£ãŸã“ã¨ã‚’ã‚„ã‚ŠãŸã„å ´åˆã¯ **channel** ã‚·ã‚°ãƒŠãƒ«ã‚’ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ã€‚


